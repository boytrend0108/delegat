import{b as g,_ as E,r as c,o as s,c as n,d as t,e as C,w as h,v as p,p as f,h as S,L as A,a2 as k,F as I,i as P,t as m,m as b,B as G,g as l,f as i,a9 as $}from"./index-CJPfqmld.js";import{C as V}from"./ChatBox2-uF-uoGLq.js";const M={name:"success-provider-selected",methods:{...g(["SHOW_DIALOG"]),handler(){this.SHOW_DIALOG()},toToApplication(){this.SHOW_DIALOG(),this.$router.push("/customer/my_applications")}}},R=e=>(f("data-v-5be8bd5c"),e=e(),S(),e),N={class:"successSubscribe"},B=R(()=>t("img",{src:A,alt:"check"},null,-1)),W=R(()=>t("p",{class:"msg"}," Вы выбрали исполнителя по заявке ",-1)),q={class:"btn-wr"};function x(e,o,u,_,r,d){const a=c("my-blue-btn");return s(),n("div",N,[B,W,t("div",q,[C(a,{onClick:d.toToApplication,class:"btn"},{default:h(()=>[p("Показать список заявок")]),_:1},8,["onClick"]),C(a,{class:"btn",onClick:d.handler},{default:h(()=>[p("Продолжить чат с исполнителем")]),_:1},8,["onClick"])])])}const H=E(M,[["render",x],["__scopeId","data-v-5be8bd5c"]]),U={name:"rating-stars",props:{rating:{type:Object}},setup(e){const o=_=>_>e.rating.grade?"white":"#339DFF",u=k(()=>window.innerWidth<600?"22":"30");return{color:o,starSize:u}}},O=e=>(f("data-v-ef65d96d"),e=e(),S(),e),z={class:"rating"},j=O(()=>t("div",{class:"rating__title"},"Рейтинг специалиста",-1)),K={class:"stars"},Q=["width","height","fill"],Y=O(()=>t("path",{d:"M21.4545 19.1512L21.4545 19.1512L21.456 19.1569L23.5089 27.2278C23.5089 27.2279 23.5089 27.228 23.5089 27.228C23.5251 27.292 23.5177 27.3355 23.506 27.3667C23.4925 27.4028 23.4668 27.438 23.4316 27.4647C23.3963 27.4914 23.3623 27.5017 23.3377 27.5034C23.3195 27.5046 23.289 27.5032 23.2407 27.4729C23.2404 27.4727 23.2401 27.4726 23.2399 27.4724L16.1555 22.9744L15.6189 23.8182L16.1549 22.974L16.1554 22.9743C15.8101 22.7547 15.4093 22.6381 15.0001 22.6381C14.5915 22.6381 14.1913 22.7544 13.8464 22.9734C13.8458 22.9737 13.8453 22.974 13.8448 22.9744L7.25104 27.1499L7.24918 27.1511C7.09861 27.2469 6.94546 27.2337 6.80919 27.1301C6.6698 27.0241 6.59144 26.8509 6.64554 26.6392L6.64596 26.6376L8.54441 19.1564L8.54568 19.1512C8.64658 18.7446 8.63054 18.3177 8.49941 17.9198C8.36854 17.5227 8.12836 17.1706 7.80644 16.9038C7.80581 16.9033 7.80517 16.9027 7.80454 16.9022L1.45157 11.6034L1.44995 11.602C1.40768 11.5669 1.38997 11.5328 1.38123 11.4996C1.37099 11.4607 1.37072 11.4107 1.38665 11.3592C1.40256 11.3078 1.42912 11.2723 1.45262 11.2524C1.47083 11.2371 1.49742 11.2212 1.55033 11.2177C1.55036 11.2177 1.5504 11.2177 1.55043 11.2177C1.55057 11.2177 1.55071 11.2177 1.55085 11.2177L9.84472 10.6835C10.2637 10.6584 10.6665 10.5121 11.004 10.2625C11.3389 10.0147 11.5953 9.67567 11.7425 9.28607L14.8326 1.50446C14.8362 1.49543 14.8397 1.48635 14.843 1.47722C14.8547 1.44498 14.8761 1.41712 14.9042 1.39743C14.9323 1.37775 14.9658 1.36719 15.0001 1.36719C15.0344 1.36719 15.0679 1.37775 15.096 1.39743C15.1241 1.41712 15.1455 1.44498 15.1572 1.47723C15.1606 1.48635 15.164 1.49543 15.1676 1.50446L18.2578 9.28615C18.405 9.6757 18.6613 10.0147 18.9963 10.2625L19.591 9.45853L18.9963 10.2625C19.3338 10.5121 19.7365 10.6584 20.1555 10.6835C20.1568 10.6836 20.158 10.6836 20.1592 10.6837L28.4494 11.2177C28.4495 11.2177 28.4497 11.2177 28.4498 11.2177C28.4498 11.2177 28.4499 11.2177 28.4499 11.2177C28.5028 11.2212 28.5294 11.2371 28.5476 11.2524C28.5711 11.2723 28.5977 11.3078 28.6136 11.3592C28.6295 11.4107 28.6292 11.4607 28.619 11.4996C28.6103 11.5328 28.5926 11.5669 28.5503 11.602L28.5487 11.6034L22.1957 16.9022C22.1952 16.9027 22.1946 16.9031 22.1941 16.9036C21.872 17.1704 21.6317 17.5226 21.5008 17.9198C21.3697 18.3177 21.3537 18.7446 21.4545 19.1512Z",stroke:"#339DFF","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)),Z=[Y],J={class:"rating__amount_reviews"};function X(e,o,u,_,r,d){return s(),n(I,null,[t("div",z,[j,t("div",K,[(s(),n(I,null,P(5,a=>t("div",{class:"rating__stars",key:a},[(s(),n("svg",{width:_.starSize,height:_.starSize,viewBox:"0 0 30 29",fill:_.color(a),xmlns:"http://www.w3.org/2000/svg"},Z,8,Q))])),64))])]),t("p",J,"Всего оценок: "+m(u.rating.amount_reviews),1)],64)}const ee=E(U,[["render",X],["__scopeId","data-v-ef65d96d"]]),se={name:"customer-chat",components:{ChatBox2:V,SuccessProviderSelected:H,RatingStars:ee},data(){return{messages:[],newMessage:null,connection:null,innerWidth:window.innerWidth,showPreloader:!1,statement:"",successMsg:!1,errorMsg:!1,addCompany:!1,selectNextStep:!1,success:!1}},computed:{...b(["AVATAR_BY_ID","SPECIFIC_OFFER","GUEST_AVATAR","IS_ORDER_SELECTED","FID","DIALOG","BANK","RATING"]),showBtn(){return this.SPECIFIC_OFFER.status==="PENDING"&&!this.IS_ORDER_SELECTED}},methods:{...G(["SELECT_PROVIDER","GET_SPECIFIC_OFFER","GET_PROVIDER_OFFERS","CONFIRM_ORDER","GET_PROVIDER_RATING"]),...g(["SET_SPECIFIC_OFFER","SET_GUEST_AVATAR","SET_IS_ORDER_SELECTED","SHOW_DIALOG","SET_LEAVE_SELECTED_OFFER"]),firmValidation(){return!(!this.FID||!this.BANK[0].bic)},changeQuery(){this.$router.push({query:{provider:this.$route.query.provider,offer_id:this.$route.query.offer_id,status:"IN_PROGRESS",type:this.$route.query.type}})},async selectProvider(){if(!this.firmValidation()){this.addCompany=!0,this.SHOW_DIALOG(),setTimeout(()=>{this.$router.push("/customer/profile/#company"),this.DIALOG&&this.SHOW_DIALOG(),this.addCompany=!1},7e3);return}this.showPreloader=!0,this.errorMsg=!1;const e={order_id:this.SPECIFIC_OFFER.order_id,offer_id:this.SPECIFIC_OFFER.id};try{await this.SELECT_PROVIDER(e),this.success=!0,this.showPreloader=!1,this.successMsg=!0,this.SHOW_DIALOG(),this.SET_LEAVE_SELECTED_OFFER(this.$route.query.offer_id),this.changeQuery()}catch(o){console.log(o),this.errorMsg=!0,this.showPreloader=!1}},confirmOrder(){debugger;this.showPreloader=!0,this.CONFIRM_ORDER(this.order.id).then(()=>{this.$router.push({query:{status:"COMPLETED"}}),this.statement="Заявка закрыта",this.showPreloader=!1,setTimeout(()=>{this.statement="",this.SHOW_DIALOG()},2e3)}).catch(e=>{this.showPreloader=!1,this.statement=e,setTimeout(()=>{this.statement=""},2e3)})}},mounted(){const e=this.$route.params.id;this.GET_SPECIFIC_OFFER({user_id:this.$route.query.provider,order_id:e}).then(o=>{o.owner_avatar_path!==null&&this.SET_GUEST_AVATAR(`https://static.delegat.online/${o.owner_avatar_path}`)}),this.GET_PROVIDER_OFFERS(e),this.GET_PROVIDER_RATING(e)},unmounted(){console.log("ChatPage unmounted"),this.SET_IS_ORDER_SELECTED(!1)}},L=e=>(f("data-v-783598a5"),e=e(),S(),e),te={class:"customer-chat"},re={class:"chat__header"},oe={class:"provider_wr"},ie={class:"user"},ne=["src"],ae={class:"provider"},ce={class:"provider__name"},_e={key:0,class:"hr"},de={key:0,class:"successMsg"},le={key:1,class:"errorMsg"},he={key:0,class:"msg-wr"},ue=L(()=>t("p",{class:"warningMsg"},"Чтобы выбрать специалиста надо добавить фирму и реквизиты счета.",-1)),Ce=L(()=>t("p",{class:"warningMsg"},"Сейчас вы будете перенаправленны на нужную страницу",-1)),pe=[ue,Ce];function me(e,o,u,_,r,d){const a=c("my-color-btn"),y=c("rating-stars"),v=c("my-blue-btn"),F=c("chat-box2"),T=c("my-big-spinner"),w=c("success-provider-selected"),D=c("my-dialog");return s(),n("div",te,[t("header",re,[t("div",oe,[t("div",ie,[r.innerWidth<600?(s(),l(a,{key:0,class:"btn-back",onClick:o[0]||(o[0]=Ee=>e.$router.go("-1"))})):i("",!0),t("img",{src:e.GUEST_AVATAR,alt:"aватар",class:"avatar"},null,8,ne),t("div",ae,[t("div",ce,m(e.SPECIFIC_OFFER.owner_name),1)])]),(s(),l($,null,{default:h(()=>[C(y,{rating:e.RATING},null,8,["rating"])]),_:1}))]),r.innerWidth<600?(s(),n("hr",_e)):i("",!0),d.showBtn?(s(),l(v,{key:1,id:"select_provider",onClick:d.selectProvider},{default:h(()=>[p("Выбрать специалиста")]),_:1},8,["onClick"])):i("",!0),e.$route.query.status==="IN_PROGRESS"&&r.innerWidth<600?(s(),l(a,{key:2,class:"cancelBtn",onClick:d.confirmOrder},{default:h(()=>[p(" Завершить поставку ")]),_:1},8,["onClick"])):i("",!0),r.statement?(s(),n("p",{key:3,class:"successDelete",ref:"deleteMsg"},m(r.statement),513)):i("",!0)]),r.successMsg?(s(),n("p",de," Вы выбрали этого специалиста ")):i("",!0),r.errorMsg?(s(),n("p",le," Упс, что-то пошло не так... ")):i("",!0),C(F,{class:"chatBox"}),r.showPreloader?(s(),l(T,{key:2})):i("",!0),e.DIALOG?(s(),l(D,{key:3},{default:h(()=>[r.addCompany?(s(),n("div",he,pe)):i("",!0),r.success?(s(),l(w,{key:1})):i("",!0)]),_:1})):i("",!0)])}const Ie=E(se,[["render",me],["__scopeId","data-v-783598a5"]]);export{Ie as default};
