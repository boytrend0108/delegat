import{b as I,_ as R,r as n,o,c as a,d as s,e as u,w as p,v as O,p as T,h as g,V as B,m as C,B as A,g as m,f as d,y as U,z as V,n as f,F as b,i as H,aj as q,t as _,af as Y,ak as w,a6 as x,H as W}from"./index-CJPfqmld.js";import{b as z}from"./ApplicationForm-BukldAMN.js";const j={name:"proposal-sent-form",methods:{...I(["SWITCH_SHOW_PROPOSAL_SENT_FORM","SHOW_DIALOG"]),goToChat(){this.SHOW_DIALOG(),this.SWITCH_SHOW_PROPOSAL_SENT_FORM(!1),this.$router.push("/provider/chats")},goToSearch(){this.SHOW_DIALOG(),this.SWITCH_SHOW_PROPOSAL_SENT_FORM(!1),this.$router.push("/provider/search/")},closeDialog(){this.SWITCH_SHOW_PROPOSAL_SENT_FORM(!1),this.SHOW_DIALOG()}}},K=e=>(T("data-v-8dc5e139"),e=e(),g(),e),X={class:"proposalSent"},J=K(()=>s("h2",{class:"form__title"},"Предложение отправлено",-1)),Q={class:"form__btnbox"};function Z(e,r,c,D,t,i){const h=n("my-white-btn");return o(),a("div",X,[J,s("div",Q,[u(h,{class:"bnt-white",onClick:i.goToSearch},{default:p(()=>[O(" Продолжить поиск заказов ")]),_:1},8,["onClick"])])])}const ss=R(j,[["render",Z],["__scopeId","data-v-8dc5e139"]]),es={name:"dialog-with-customer",components:{ValidationErrors:B},data(){return{offer_message:"",showPreloader:!1,priceValidation:!0}},computed:{...C(["INPUT","VALIDATION_ERRORS","OFFER_MSG","USER_BY_ID","CURRENT_USER","CHAT_ID","FID"]),isBtnDisabled(){return!(this.offer_message&&this.INPUT&&this.priceValidation)}},methods:{...A(["SEND_OFFER","CREATE_CHAT","SEND_MSG"]),...I(["SHOW_DIALOG","SWITCH_DIALOG_WITH_CUSTOMER","SWITCH_SHOW_PROPOSAL_SENT_FORM","SET_OFFER_MSG","SET_OFFER_PRICE","SET_IS_OFFER_SENDED"]),isPriceValid(e){this.priceValidation=e},sendProposal(){this.showPreloader=!0;const e={offer_price:this.INPUT.replace(/ /g,""),offer_message:this.offer_message,firm_id:this.FID},r={orderId:this.$route.params.id,formData:e};this.SEND_OFFER(r).then(c=>(this.$router.push({query:{offer_id:c.data.id}}),this.CREATE_CHAT({order_id:this.$route.params.id,offer_id:c.data.id,customer_id:this.USER_BY_ID.uid,provider_id:this.CURRENT_USER.uid}))).then(()=>{const c={chat_id:this.CHAT_ID,body:this.offer_message,type:"text",content:"string"};return this.SEND_MSG(c)}).then(()=>{this.SWITCH_SHOW_PROPOSAL_SENT_FORM(!0),this.SWITCH_DIALOG_WITH_CUSTOMER(!1),this.SET_IS_OFFER_SENDED(!0)}).catch(c=>{console.log(c),this.showPreloader=!1})},closeDialog(){this.$router.replace({query:{}}),this.SWITCH_DIALOG_WITH_CUSTOMER(!1),this.SWITCH_SHOW_PROPOSAL_SENT_FORM(!1),this.SHOW_DIALOG()}},mounted(){this.offer_message=this.OFFER_MSG?this.OFFER_MSG:""}},F=e=>(T("data-v-efcfb216"),e=e(),g(),e),ts={class:"form dialogWithCustomer"},os=F(()=>s("h2",{class:"form__title"},"Начните диалог с заказчиком",-1)),_s=F(()=>s("p",{class:"form__note"},"Укажите примерную стоимость работы и задайте интересующие вас вопросы",-1)),is=F(()=>s("label",{for:"priceOfWork",class:"form__lable"},"Примерная стоимость работы",-1)),rs=F(()=>s("p",{class:"symbol"},"₽",-1)),as={class:"btn-wr"};function ns(e,r,c,D,t,i){const h=n("validation-errors"),S=n("my-input"),y=n("my-blue-btn"),L=n("my-semipolar-spinner");return o(),a("div",ts,[os,_s,e.VALIDATION_ERRORS?(o(),m(h,{key:0,class:"err","validation-errors":e.VALIDATION_ERRORS},null,8,["validation-errors"])):d("",!0),is,u(S,{class:"form__input-price",id:"priceOfWork",onError:i.isPriceValid},{default:p(()=>[rs]),_:1},8,["onError"]),U(s("textarea",{"onUpdate:modelValue":r[0]||(r[0]=v=>t.offer_message=v),class:"form__textaria",name:"dialogWithCustomer",id:"dialogWithCustomerTextAria",placeholder:"Написать сообщение...",onInput:r[1]||(r[1]=v=>e.SET_OFFER_MSG(t.offer_message))},null,544),[[V,t.offer_message]]),s("div",as,[u(y,{onClick:i.sendProposal,disabled:i.isBtnDisabled,class:f({disabled:i.isBtnDisabled})},{default:p(()=>[O("Отправить ")]),_:1},8,["onClick","disabled","class"]),t.showPreloader?(o(),m(L,{key:0,class:"preloader"})):d("",!0)])])}const ds=R(es,[["render",ns],["__scopeId","data-v-efcfb216"]]),cs={name:"application-download-photo",data(){return{images:[],showBig:!1,bigImg:"",changeClass:!1}},computed:{...C(["DOCS"])},methods:{...A(["CHECK_IMAGE_EXIST","GET_IMAGE_FROM_SERVER"]),...I(["SET_HREF_FILE"]),showBigImg(e){this.bigImg=e.target.getAttribute("src"),this.showBig=!0},hideBigImg(){this.changeClass=!0,setTimeout(()=>{this.showBig=!1,this.bigImg=null,this.changeClass=!1},300)}},mounted(){this.SET_HREF_FILE({id:"clear"}),this.GET_IMAGE_FROM_SERVER({orderId:this.$route.params.id,size:"640"}).then(()=>{this.images=this.DOCS.images.href})}},ls=e=>(T("data-v-b12c6298"),e=e(),g(),e),hs={class:"summary__item",id:"info2"},ms=ls(()=>s("p",{class:"summary__question"}," Фото товара",-1)),us={key:0,class:"wr"},ps=["src"],Es=["src"],Ss={key:1,class:"warningMsg"};function Os(e,r,c,D,t,i){return o(),a("div",hs,[ms,t.images.length?(o(),a("div",us,[(o(!0),a(b,null,H(t.images,h=>(o(),a("img",{key:h,src:h,alt:"photo",class:"photo",onClick:r[0]||(r[0]=(...S)=>i.showBigImg&&i.showBigImg(...S))},null,8,ps))),128)),t.showBig?(o(),a("div",{key:0,class:f(["foto-wr scale-in-center",{"scale-in-center":!this.changeClass,"scale-out-center":this.changeClass}]),onClick:r[1]||(r[1]=(...h)=>i.hideBigImg&&i.hideBigImg(...h))},[s("img",{src:t.bigImg,alt:"photo",class:"photo-big"},null,8,Es)],2)):d("",!0)])):d("",!0),t.images.length?d("",!0):(o(),a("p",Ss,"Заказчик не загрузил фото товара"))])}const fs=R(cs,[["render",Os],["__scopeId","data-v-b12c6298"]]),Is={name:"application-download-invoice-and-plist",computed:{...C(["DOCS","SITE_ROLE"])},methods:{...I(["SHOW_DIALOG","SET_CLEAR_INVOICE_AND_PLIST","SET_SHOW_PDF_VIEWER"]),...A(["GET_FILE_FROM_SERVER"])},setup(){q(()=>{Y.commit("SET_CLEAR_INVOICE_AND_PLIST")})},mounted(){const e=this.$route.params.id;this.GET_FILE_FROM_SERVER({orderId:e,inputId:"order_invoice"}),this.GET_FILE_FROM_SERVER({orderId:e,inputId:"order_packing_list"})}},E=e=>(T("data-v-5dd3281b"),e=e(),g(),e),Rs={class:"download-bottom"},Ts=E(()=>s("h3",{class:"ariaTitle"},"Инвойс",-1)),gs={class:"download__box-bottom"},Ds={class:"wrapper"},ys={key:0,class:"downloadAria-done disable"},vs=E(()=>s("div",null,[s("img",{src:w,alt:"file"}),s("p",{class:"inputTitle"}," Инвойс не загружен")],-1)),Cs=[vs],As=["href","download"],ws={id:"order_invoice"},Fs=E(()=>s("img",{src:w,alt:"file"},null,-1)),Ls={class:"inputTitle"},Ps={class:"download-bottom"},Ws=E(()=>s("h3",{class:"ariaTitle"},"Упаковочный лист",-1)),bs={class:"download__box-bottom"},Hs={class:"wrapper"},Ns={key:0,class:"downloadAria-done disable"},ks=E(()=>s("div",null,[s("img",{src:w,alt:"file"}),s("p",{class:"inputTitle"}," Упаковочный лист не загружен")],-1)),$s=[ks],Gs=["href","download"],Ms={id:"order_packing_list"},Bs=E(()=>s("img",{src:w,alt:"file"},null,-1)),Us={class:"inputTitle"};function Vs(e,r,c,D,t,i){return o(),a("div",Rs,[Ts,s("div",gs,[s("div",Ds,[e.DOCS.order_invoice.href?(o(),a("a",{key:1,href:e.DOCS.order_invoice.href,target:"_blank",download:`Инвойс для заявки № ${this.$route.params.id}.${e.DOCS.order_invoice.ext}`,class:"link downloadAria-done"},[s("div",ws,[s("div",null,[Fs,s("p",Ls,_(e.DOCS.order_invoice.name),1)])])],8,As)):(o(),a("div",ys,Cs))])]),s("div",Ps,[Ws,s("div",bs,[s("div",Hs,[e.DOCS.order_packing_list.href?(o(),a("a",{key:1,href:e.DOCS.order_packing_list.href,target:"_blank",download:`Упаковочный лист для заявки № ${this.$route.params.id}.${e.DOCS.order_packing_list.ext}`,class:"link downloadAria-done"},[s("div",Ms,[s("div",null,[Bs,s("p",Us,_(e.DOCS.order_packing_list.name),1)])])],8,Gs)):(o(),a("div",Ns,$s))])])])])}const qs=R(Is,[["render",Vs],["__scopeId","data-v-5dd3281b"]]),Ys={name:"provider-application",components:{DialogWithCustomerForm:ds,ApplicationForm:z,ProposalSentForm:ss,ApplicationDownloadPhoto:fs,ApplicationDownloadInvoiceAndPList:qs},data(){return{files:[],value:"",inputTitle_1:"инвойс",inputTitle_2:"упаковочный лист",id_1:"input",id_2:"order_invoice",id_3:"order_packing_list",dialogWithCustomer:!1,order:"",showPreloader:!1,order_packing_list:"",order_invoice:"",image:[],customer:{},additional_services:[],delivery_type:""}},computed:{...C(["DIALOG","TITLE","CURRENT_USER","DIALOG_WITH_CUSTOMER","SHOW_PROPOSAL_SENT_FORM","SHOW_APPLICATION_FORM","ALL_PUBLISHED_ORDERS","PUBLISHED_ORDERS_CUSTOMER","DOCS","CUSTOMER_FIRM","SELECTED_ORDER","IS_OFFER_SENDED","BTN_ID","SHOW_PDF_VIEWER","WEIGHT","CAPACITY","DATE_OF_READINESS","AVATAR_BY_ID","NEW_OFFER_IN_PROGRESS"]),paramsOrderId(){return this.$route.params.id},dateCreated(){if(this.order)return this.order.created_at.split("").slice(0,10).join("")},src(){switch(this.BTN_ID){case"order_invoice":return this.DOCS.order_invoice.customer.url;case"order_packing_list":return this.DOCS.order_packing_list.url}},showBtn(){return!(this.order.status==="IN_PROGRESS"||this.order.status==="COMPLETED"||this.$route.query.feedback==="true"||this.IS_OFFER_SENDED)},setAvatar(){return this.AVATAR_BY_ID==="https://static.delegat.online/default/user.png"?require("@/assets/images/icons/user.svg"):this.AVATAR_BY_ID}},methods:{...I(["SHOW_DIALOG","SWITCH_DIALOG_WITH_CUSTOMER","SET_OFFER_PRICE","SET_OFFER_MSG","SET_IS_OFFER_SENDED","SET_CHAT_ID","SET_NEW_OFFER_IN_PROGRESS","SET_SHOW_PRELOADER","SET_CLEAR_NEW_APPLICATION","SET_CLEAR_DOCS"]),...A(["DOWNLOAD_DOCS","GET_AVATAR_BY_ID","GET_CUSTOMER_ORDER_BY_ID","GET_USER_BY_ID","GET_CHAT_ID"]),getOrderById(){this.SET_SHOW_PRELOADER(!0),this.GET_CUSTOMER_ORDER_BY_ID(this.$route.params.id).then(e=>{debugger;this.order=e,this.additional_services=this.order.additional_services,this.delivery_type=this.order.delivery_type,this.GET_USER_BY_ID(this.order.user_id).then(r=>this.customer=r),this.GET_AVATAR_BY_ID(e.user_id),this.$route.query.offer_id?this.GET_CHAT_ID({order_id:this.$route.params.id,offer_id:this.$route.query.offer_id}):this.SET_CHAT_ID(null),this.SET_SHOW_PRELOADER(!1)}).catch(()=>this.SET_SHOW_PRELOADER(!1))},showDialogLogic(){this.$router.push({query:{form:"dialog"}}),this.SWITCH_DIALOG_WITH_CUSTOMER(!0),this.SHOW_DIALOG()},downloadFile(){this.DOWNLOAD_DOCS().then(()=>{document.querySelector("#downloadPackageList").click()})},goToCustomerPage(){this.CURRENT_USER?this.$router.push("/customer?module=select_company"):this.$router.push("/login")}},watch:{paramsOrderId(){this.getOrderById()}},mounted(){this.SET_IS_OFFER_SENDED(!1),this.getOrderById(),this.NEW_OFFER_IN_PROGRESS.includes(+this.$route.query.offer_id)&&this.SET_NEW_OFFER_IN_PROGRESS({data:this.$route.query.offer_id,action:"delete"}),x()},unmounted(){this.SET_CLEAR_NEW_APPLICATION(),this.SET_CLEAR_DOCS(),this.SET_OFFER_MSG(""),this.SET_OFFER_PRICE("")}},l=e=>(T("data-v-f29d5dfd"),e=e(),g(),e),xs={class:"providerApplication"},zs=l(()=>s("h1",{class:"visually-hidden"},"Заявка",-1)),js={class:"title"},Ks={class:"header"},Xs={class:"header__item"},Js=l(()=>s("p",{class:"header__title"}," Заказчик ",-1)),Qs={class:"customer"},Zs=["src"],se={class:"text"},ee={class:"header__item"},te=l(()=>s("p",{class:"header__title"},"Опубликована",-1)),oe={class:"text"},_e={class:"header__item btn-wr"},ie={class:"scroll"},re={class:"summary"},ae={class:"summary__item",id:"country"},ne=l(()=>s("p",{class:"summary__question"}," Страна отправления ",-1)),de={class:"summary__answer"},ce={class:"summary__item",id:"cities"},le={class:"summary__question"},he={class:"summary__answer"},me={class:"summary__item",id:"naming"},ue=l(()=>s("p",{class:"summary__question"}," Название заявки ",-1)),pe={class:"summary__answer"},Ee={class:"summary__item",id:"product"},Se=l(()=>s("p",{class:"summary__question"}," Краткое описание товара ",-1)),Oe={class:"summary__answer"},fe=l(()=>s("p",{class:"summary__question"}," Общий вес БРУТТО, кг ",-1)),Ie={class:"summary__answer"},Re=l(()=>s("p",{class:"summary__question"}," Общий объём груза, м³ ",-1)),Te={class:"summary__answer"},ge=l(()=>s("p",{class:"summary__question"}," Дата готовности груза ",-1)),De={class:"summary__answer"},ye={class:"summary__item",id:"additional_services"},ve=l(()=>s("p",{class:"summary__question"}," Требуемые услуги ",-1)),Ce={class:"summary__answer"},Ae={class:"summary__ul"},we={key:0,class:"summary__li"},Fe={class:"summary__item",id:"delivery_type"},Le={class:"summary__question"},Pe={class:"summary__answer"},We={class:"summary__item",id:"info2"},be=l(()=>s("p",{class:"summary__question"},"Контакты представителя фабрики",-1)),He={class:"summary__answer"},Ne={class:"header__item"};function ke(e,r,c,D,t,i){const h=n("font-awesome-icon"),S=n("my-color-btn"),y=n("my-blue-btn"),L=n("application-download-photo"),v=n("application-download-invoice-and-p-list"),N=n("application-form"),k=n("dialog-with-customer-form"),$=n("proposal-sent-form"),G=n("my-dialog"),M=n("my-big-spinner");return o(),a("div",xs,[zs,u(S,{class:"btn-back",onClick:r[0]||(r[0]=W(P=>this.$router.push("/provider/feedbacks/?status=pending"),["stop"]))},{default:p(()=>[u(h,{icon:"fa-solid fa-chevron-left"}),O(" Вернуться к списку ")]),_:1}),s("h2",js,'Заявка " '+_(t.order.name)+' " ',1),s("div",Ks,[s("div",Xs,[Js,s("div",Qs,[s("img",{class:"avatar",src:i.setAvatar,alt:"avatar"},null,8,Zs),s("p",se,_(t.customer.full_name),1)])]),s("div",ee,[te,s("p",oe,_(i.dateCreated),1)]),s("div",_e,[i.showBtn?(o(),m(y,{key:0,onClick:W(i.showDialogLogic,["self","stop"])},{default:p(()=>[O("Откликнуться")]),_:1},8,["onClick"])):d("",!0)])]),s("div",ie,[s("section",re,[s("div",ae,[ne,s("p",de,_(t.order.from_country)+" "+_(t.order.from_address),1)]),s("div",ce,[s("p",le,_(this.TITLE.cities),1),s("p",he,_(t.order.to_city)+" "+_(t.order.to_address),1)]),s("div",me,[ue,s("p",pe,_(t.order.name),1)]),s("div",Ee,[Se,s("p",Oe,_(t.order.description),1)]),s("div",{class:f(["summary__item",{warning:!t.order.net}]),id:"weight"},[fe,s("p",Ie,_(t.order.net),1)],2),s("div",{class:f(["summary__item",{warning:!t.order.cargo_volume}]),id:"capacity"},[Re,s("p",Te,_(t.order.cargo_volume),1)],2),s("div",{class:f(["summary__item",{warning:!t.order.date_of_cargo_readiness}]),i:"",d:"dateOfReadiness2"},[ge,s("p",De,_(t.order.date_of_cargo_readiness),1)],2),s("div",ye,[ve,s("div",Ce,[s("ul",Ae,[(o(!0),a(b,null,H(t.additional_services,P=>(o(),a("li",{class:"summary__li",key:P.id},_(P),1))),128)),t.order.comment_for_service?(o(),a("li",we,_(t.order.comment_for_service),1)):d("",!0)])])]),s("div",Fe,[s("p",Le,_(this.TITLE.delivery_type),1),s("p",Pe,_(t.delivery_type),1)]),s("div",We,[be,s("p",He,_(t.order.agent_fullname)+" "+_(t.order.agent_phone_number)+" "+_(t.order.agent_email),1)]),u(L),u(v,{class:"download-bottom"}),s("div",Ne,[i.showBtn?(o(),m(y,{key:0,onClick:W(i.showDialogLogic,["self","stop"]),class:"btn-blue"},{default:p(()=>[O("Откликнуться")]),_:1},8,["onClick"])):d("",!0)])])]),e.DIALOG?(o(),m(G,{key:0},{default:p(()=>[e.SHOW_APPLICATION_FORM?(o(),m(N,{key:0})):d("",!0),e.DIALOG_WITH_CUSTOMER?(o(),m(k,{key:1})):d("",!0),e.SHOW_PROPOSAL_SENT_FORM?(o(),m($,{key:2})):d("",!0)]),_:1})):d("",!0),t.showPreloader?(o(),m(M,{key:1})):d("",!0)])}const Me=R(Ys,[["render",ke],["__scopeId","data-v-f29d5dfd"]]);export{Me as default};
