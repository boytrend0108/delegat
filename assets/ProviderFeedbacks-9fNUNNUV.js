import{m as S,B as v,_ as F,r as l,o as r,c as i,d as s,t as E,f as h,e as u,ae as k,p as I,h as b,al as $,b as P,w as m,n as O,v as y,g as f,$ as A,F as N,i as L}from"./index-CJPfqmld.js";const B={name:"provider-feedback",props:{offer:{type:Object}},computed:{...S(["DOCS","NEW_OFFER_IN_PROGRESS"]),time(){return this.offer.last_message_date.split("T")[1].slice(0,5)},showRedDot(){if(this.NEW_OFFER_IN_PROGRESS)return!!this.NEW_OFFER_IN_PROGRESS.includes(this.offer.offer_id)}},methods:{...v(["GET_AVATAR_FROM_SERVER","GET_CUSTOMER_ORDER_BY_ID"])}},D=e=>(I("data-v-b986c485"),e=e(),b(),e),V={class:"providerFeedback"},W={class:"wrapper"},q={class:"title"},x={key:0,src:k,alt:"отклик"},M={class:"direction"},Y={class:"address__el_down"},z={class:"address__el_down"},K=D(()=>s("hr",{class:"hr"},null,-1)),H=D(()=>s("hr",{class:"hr"},null,-1));function U(e,t,_,d,n,o){const c=l("font-awesome-icon"),p=l("my-chat-item");return r(),i("div",V,[s("div",W,[s("h2",q,E(_.offer.name),1),o.showRedDot?(r(),i("img",x)):h("",!0)]),s("div",M,[s("p",Y,E(_.offer.from_country),1),u(c,{icon:"fa-solid fa-arrow-right"}),s("p",z,E(_.offer.to_city),1)]),K,u(p,{msg:_.offer.last_message},null,8,["msg"]),H])}const j=F(B,[["render",U],["__scopeId","data-v-b986c485"]]),J={name:"provider-feedbacks",components:{ProviderFeedback:j,FeedbackFilter:$},data(){return{myOffers:[],filter_by_country:[],filter_by_city:[],show_preloader:Boolean,show_note:!1,clearData:Boolean,order_status:"pending"}},computed:{...S(["FILTER_FEEDBACK_COUNTRY","FILTER_FEEDBACK_CITY","DIALOG","PAGE","NEW_OFFER_IN_PROGRESS"]),filteredOffers(){return[...this.myOffers].filter(e=>e.to_city.toLowerCase().includes(this.FILTER_FEEDBACK_CITY.toLowerCase())&&e.from_country.toLowerCase().includes(this.FILTER_FEEDBACK_COUNTRY.toLowerCase()))}},methods:{...v(["GET_ORDERS_FOR_PROVIDER"]),...P(["SHOW_DIALOG","SET_PAGE","SET_NEW_OFFER_IN_PROGRESS"]),goToOrder(e){this.$router.push(`/provider/application/${e.id}?status=${e.status}&feedback=true&offer_id=${e.offer_id}`)},async getOffers(e){this.SET_PAGE(!0),this.order_status=e,this.show_preloader=!0,this.GET_ORDERS_FOR_PROVIDER({status:e,page_size:"10",page:this.PAGE}).then(t=>(this.myOffers=t,this.$router.push({query:{status:e}}),console.log(this.$route.query.status),this.show_note=!this.filteredOffers.length,this.show_preloader=!1,t)).then(t=>{setTimeout(()=>{this.$route.query.status==="in_progress"&&localStorage.setItem("lastOffer",t[0].offer_id)},1e3)})}},mounted(){this.show_preloader=!0,this.$router.push({query:{status:"pending"}}),this.SET_PAGE(!0),this.GET_ORDERS_FOR_PROVIDER({status:this.order_status,page_size:"10",page:this.PAGE}).then(e=>{this.myOffers=e,this.show_note=!this.filteredOffers.length,this.show_preloader=!1}).then(()=>{let e={root:null,rootMargin:"0px",threshold:.5},t=n=>{n.forEach(o=>{o.isIntersecting&&(console.log("entry >>>>"),this.SET_PAGE(),this.GET_ORDERS_FOR_PROVIDER({status:this.order_status,page_size:"10",page:this.PAGE}).then(c=>{this.myOffers=[...this.myOffers,...c]}))})},_=new IntersectionObserver(t,e),d=document.querySelector(".target");d&&_.observe(d)}),this.GET_ORDERS_FOR_PROVIDER({status:"in_progress",page:0}).then(e=>{debugger;e.forEach(t=>{t.offer_id>localStorage.getItem("lastOffer")&&this.SET_NEW_OFFER_IN_PROGRESS({data:t.offer_id,action:"add"})})})}},R=e=>(I("data-v-fd9a51ac"),e=e(),b(),e),Q={class:"feedbacks"},X=R(()=>s("h1",{class:"title"},"Mои заявки",-1)),Z={key:0,class:"noOffers"},ee={key:0,class:"text"},te={key:1,class:"text"},se={class:"offersStatus"},re={key:0,src:k,alt:"отклик"},oe={class:"wr"},ae={class:"filter__header"},ie=R(()=>s("p",{class:"filter__text"},"Фильтры",-1)),_e=R(()=>s("div",{class:"target"},null,-1));function ne(e,t,_,d,n,o){var g;const c=l("my-blue-btn"),p=l("my-big-spinner"),G=l("provider-feedback"),T=l("feedback-filter"),w=l("my-dialog");return r(),i("div",Q,[X,s("div",{class:"fiters",onClick:t[0]||(t[0]=(...a)=>e.SHOW_DIALOG&&e.SHOW_DIALOG(...a))},"Фильтры"),n.show_note&&!o.filteredOffers.length?(r(),i("div",Z,[e.$route.query.status==="completed"?(r(),i("p",ee,"У вас ещё нет завершенных заявок")):(r(),i("p",te,"У вас ещё нет откликов")),u(c,{onClick:t[1]||(t[1]=a=>this.$router.push("/provider/search/"))},{default:m(()=>[y("Найти заказ ")]),_:1})])):h("",!0),s("ul",se,[s("li",{class:O(["offersStatus__li",{active:this.$route.query.status==="pending"}]),onClick:t[2]||(t[2]=a=>o.getOffers("pending"))}," Отклики ",2),s("li",{class:O([{active:this.$route.query.status==="in_progress"},"offersStatus__li"]),onClick:t[3]||(t[3]=a=>o.getOffers("in_progress"))},[y(" В работе "),(g=e.NEW_OFFER_IN_PROGRESS)!=null&&g.length?(r(),i("img",re)):h("",!0)],2),s("li",{class:O([{active:this.$route.query.status==="completed"},"offersStatus__li"]),onClick:t[4]||(t[4]=a=>o.getOffers("completed"))},"Завершенные",2)]),!o.filteredOffers.length&&n.show_preloader?(r(),f(p,{key:1})):(r(),f(A,{key:2,name:"list"},{default:m(()=>[(r(!0),i(N,null,L(o.filteredOffers,(a,C)=>(r(),f(G,{key:C,offer:a,class:"providerFeedback",onClick:le=>o.goToOrder(a)},null,8,["offer","onClick"]))),128))]),_:1})),e.DIALOG?(r(),f(w,{key:3},{default:m(()=>[s("div",oe,[s("div",ae,[ie,s("p",{class:"filter__text clean",onClick:t[5]||(t[5]=a=>n.clearData=!0)},"Очистить")]),u(T,{clearData:n.clearData,class:"feedbackFilter"},null,8,["clearData"])])]),_:1})):h("",!0),_e])}const de=F(J,[["render",ne],["__scopeId","data-v-fd9a51ac"]]);export{de as default};
