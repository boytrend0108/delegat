import{o as l,c as r,d as s,m,B as E,_ as S,f as c,t as p,p as A,h as O,ah as k,b as T,r as _,e as a,w as h,v as u,n as b}from"./index-CJPfqmld.js";const v={xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",fill:"none"},P=s("path",{stroke:"#fff","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M39 39H9a3 3 0 0 1-3-3V15a3 3 0 0 1 3-3h6l3-4.5h12l3 4.5h6a3 3 0 0 1 3 3v21a3 3 0 0 1-3 3"},null,-1),U=s("path",{stroke:"#fff","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M24 31.5A6.75 6.75 0 1 0 24 18a6.75 6.75 0 0 0 0 13.5"},null,-1),g=[P,U];function y(e,o){return l(),r("svg",v,[...g])}const N={render:y},I={name:"profile-header",data(){return{innerWidth:window.innerWidth,showDropdown:!1}},computed:{...m(["USER_NAME","USER_CREATED_DATE","DOCS"]),yearOfCreated(){return this.USER_CREATED_DATE.split("-")[0]+" года"},src(){return this.DOCS.upload_user_pic.href?this.DOCS.upload_user_pic.href:this.DOCS.upload_user_pic.file?this.DOCS.upload_user_pic.file:require("@/assets/images/icons/user.svg")}},methods:{...E(["UPLOAD_DOCS","UPLOAD_AVATAR_TO_SERVER","GET_AVATAR_FROM_SERVER"]),async uploadAvatar(e){await this.UPLOAD_DOCS(e).then(()=>{this.UPLOAD_AVATAR_TO_SERVER()})},showDropdownFn(){this.innerWidth>600||(this.showDropdown?(this.$refs.dropdown.classList.remove("swing-in-top-fwd"),this.$refs.dropdown.classList.add("swing-out-top-bck"),setTimeout(()=>{this.showDropdown=!1},400)):this.showDropdown=!0)}},mounted(){this.GET_AVATAR_FROM_SERVER()}},d=e=>(A("data-v-e36909e5"),e=e(),O(),e),F={class:"profileHeader"},V=["src"],B=d(()=>s("div",{class:"background"},null,-1)),L=d(()=>s("img",{src:N,alt:"camera",class:"icon"},null,-1)),W={key:1,ref:"dropdown",class:"dropdown swing-in-top-fwd"},H={class:"dropdown-li"},M=d(()=>s("label",{for:"upload-user-pic-mobile",class:"dropdown-li upload"}," Загрузить с устройства ",-1)),G=d(()=>s("hr",{class:"hr"},null,-1)),x={class:"dropdown-li"},j=d(()=>s("label",{for:"takePictureField",class:"dropdown-li upload"}," Сделать фото ",-1)),q={class:"user"},z={class:"name"},Y={class:"since"};function J(e,o,w,R,i,t){return l(),r("div",F,[i.innerWidth>600?(l(),r("input",{key:0,type:"file",id:"upload-user-pic",onChange:o[0]||(o[0]=n=>t.uploadAvatar(n)),class:"hidden"},null,32)):c("",!0),s("label",{class:"img",for:"upload-user-pic",onClick:o[1]||(o[1]=(...n)=>t.showDropdownFn&&t.showDropdownFn(...n))},[e.DOCS.upload_user_pic.href||e.DOCS.upload_user_pic.file?(l(),r("img",{key:0,src:t.src,alt:"avatar",class:"avatar"},null,8,V)):c("",!0),B,L]),i.showDropdown?(l(),r("ul",W,[s("li",H,[s("input",{type:"file",id:"upload-user-pic-mobile",onChange:o[2]||(o[2]=n=>t.uploadAvatar(n)),class:"hidden"},null,32),M]),G,s("li",x,[s("input",{type:"file",capture:"camera",accept:"image/*",class:"hidden",onChange:o[3]||(o[3]=n=>t.uploadAvatar(n)),id:"takePictureField"},null,32),j])],512)):c("",!0),s("div",q,[s("p",z,p(e.USER_NAME),1),s("p",Y,"На сервисе с "+p(t.yearOfCreated),1)])])}const oe=S(I,[["render",J],["__scopeId","data-v-e36909e5"]]),K={components:{MyProfileInput:k},name:"user-profile-form",data(){return{title_fio:"ФИО",fio:"",title_phone:"Телефон",phone:"",code:"",flag:"",title_email:"Email",email:"",isClicked:!1,isSaveBtnDisable:!0,error:""}},computed:{...m(["CURRENT_USER","FIRMS","DIALOG","SITE_ROLE"])},methods:{...E(["UPDATE_USER","SEND_NEW_COMPANY_TO_SERVER"]),...T(["SHOW_DIALOG","SET_SHOW_CHANGE_PASSWORD","SET_SHOW_PRELOADER"]),clearFn(){this.isClicked=!this.isClicked,this.fio=this.CURRENT_USER.full_name},changePassword(){localStorage.setItem("site_role",`${this.SITE_ROLE}`),this.SET_SHOW_CHANGE_PASSWORD(!0),this.SHOW_DIALOG()},setNewFio(e){this.fio=e.input,this.isSaveBtnDisable=e.status},setCode(e){this.code=e.code,this.flag=e.flag},setPhone(e){e.status?(this.phone=e.phone,this.isSaveBtnDisable=!1):this.isSaveBtnDisable=!0},changeUserData(){this.SET_SHOW_PRELOADER(!0);const e={full_name:this.fio,phone_number:`${this.phone}`};this.UPDATE_USER(e).then(()=>{this.SET_SHOW_PRELOADER(!1),this.isSaveBtnDisable=!0}).catch(o=>{this.error=o,setTimeout(()=>{this.error=""},3e3),this.SET_SHOW_PRELOADER(!1)})}},mounted(){if(this.CURRENT_USER!==null)this.fio=this.CURRENT_USER.full_name,this.email=this.CURRENT_USER.email;else return}},Q={class:"UserProfileForm"},X={class:"fildset"},Z={class:"btnBox"},$={key:0,class:"error"},ee={class:"fildset"},se={class:"btnBox"};function te(e,o,w,R,i,t){const n=_("my-profile-input"),C=_("my-phone-code"),D=_("my-blue-btn"),f=_("my-white-btn");return l(),r("div",Q,[a(n,{title:i.title_fio,profileInput:i.fio,isClicked:i.isClicked,id:"fio",class:"myProfileInput",onNewFio:t.setNewFio},null,8,["title","profileInput","isClicked","onNewFio"]),s("fieldset",X,[a(C,{onPhoneValidation:t.setPhone,onSetCode:t.setCode,isClicked:i.isClicked},null,8,["onPhoneValidation","onSetCode","isClicked"]),s("div",Z,[a(D,{onClick:t.changeUserData,class:b(["btn-blue",{disabled:i.isSaveBtnDisable}]),disabled:i.isSaveBtnDisable},{default:h(()=>[u("Coхранить")]),_:1},8,["onClick","class","disabled"]),a(f,{class:"whiteBtn",onClick:t.clearFn},{default:h(()=>[u(" Отменить ")]),_:1},8,["onClick"])])]),i.error?(l(),r("p",$,p(i.error),1)):c("",!0),s("fieldset",ee,[a(n,{title:i.title_email,profileInput:i.email,class:"myProfileInput"},null,8,["title","profileInput"]),s("div",se,[a(f,{class:"whiteBtn2",onClick:t.changePassword},{default:h(()=>[u("Сменить пароль")]),_:1},8,["onClick"])])])])}const ne=S(K,[["render",te],["__scopeId","data-v-3809f74a"]]);export{oe as P,ne as U};
